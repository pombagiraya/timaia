<div class="container">
  <div class="row justify-content-center">
    <col-6 class="col-md-8">
      <h1><%= @building.building_name %></h1>
      <h3><%= @building.user.name %></h3>
      <button type="button" class="btn btn-light"><%= link_to "Edit", edit_building_path(@building) %></button>
      <button type="button" class="btn btn-light"><%= link_to "Delete", building_path(@building), method: :delete, data: {confirm: "Are you sure?"} %></button>
      <p>Total Unpaid: <%= @unpaid %></p>
      <p>Total Unpaid and Overdue: <%= @unpaid_delay %></p>
      <p>Default Rate: <%= @default_rate %>%</p>
      <p><%= @building.city %>/<%= @building.province %></p>
      <p><%= @building.zipcode %> <%= @building.country %></p>
      <p><%= @building.super_name %> - <%= @building.super_email %></p>

      <h3>Apartments</h3>
      <button type="button" class="btn btn-light">
        <%= link_to 'New Apartment', new_building_apartment_path(@building) %>
      </button>
      <table class="table">
    <thead>
    <tr>
      <th scope="col">Apto</th>
      <th scope="col">Owner</th>
      <th scope="col">Unpaid</th>
      <th scope="col">Unpaid and Overdue</th>
      <th scope="col">Actions</th>
    </tr>
    </thead>
    <tbody>
      <% @building.apartments.each do |apartment| %>
        <tr>
          <th><%= link_to apartment.apt_number , apartment_path(apartment) %></th>
          <td><%= apartment.user.name %></td>
          <td>
          <% @apt_unpaid = 0 %>
          <% apartment.payments.each do |payment|
            if payment.status == 0
              @apt_unpaid += 1
            end
          end %>
          <%= @apt_unpaid * apartment.bill %>
          </td>
          <td>
          <% @apt_unpaid_delay = 0 %>
          <% apartment.payments.each do |payment|
            if payment.status == 0 && payment.payment_date <= Date.today
              @apt_unpaid_delay += 1
            end
          end %>
          <%= @apt_unpaid_delay * apartment.bill %>
          </td>
          <td>
            <button type="button" class="btn btn-light"><%= link_to "Edit", edit_apartment_path(apartment) %></button>
            <button type="button" class="btn btn-light"><%= link_to "Delete", apartment_path(apartment), method: :delete, data: {confirm: "Are you sure?"} %></button>
          <td>
        </tr>
      <% end %>
    </tbody>
    </table>
    <button type="button" class="btn btn-light"><%= link_to 'Back', buildings_path %></button>
    </col-6>
  </div>
</div>
